/**
 * My Learning block overview module.
 *
 * @module     block_mylearning/view
 * @copyright  2018 Moodle Pty Ltd <support@moodle.com>
 * @author     2018 David Matamoros <davidmc@moodle.com>
 * @license    http://www.gnu.org/copyleft/gpl.html GNU GPL v3 or late
 */
define("block_mylearning/view",["jquery","core/ajax","core/notification"],(function($,ajax,Notification){var SELECTOR={ALL:".dashboard-item",CERTIFICATIONNAME:'[data-region="certificationname"]',CONTROLREGION:'[data-region="dashboard-controls"]',COMPLETED:'.dashboard-item[data-completed="1"]',COURSES:'.dashboard-item[data-courses="1"]',COURSENAME:'[data-region="course-call-to-action"]',NOTCOMPLETED:'.dashboard-item:not([data-completed="1"])',PROGRAMS:'.dashboard-item[data-programs="1"]',MYLEARNINGDISPLAYDROPDOWN:"#mylearning-display-dropdown",MYLEARNINGDISPLAYDROPDOWNITEM:".mylearning-display .dropdown-item",LEARNINGITEMNAME:'[data-region="mylearningname"]',MYLEARNINGSORTINGSDROPDOWN:"#mylearning-sorting-dropdown",MYLEARNINGSORTINGSDROPDOWNITEM:".mylearning-sorting .dropdown-item",MYLEARNINGREGION:'[data-region="mylearning-overview-view"]',MYLEARNINGSTATUSDROPDOWN:"#mylearning-status-filter-dropdown",MYLEARNINGSTATUSDROPDOWNITEM:".mylearning-status-filter .dropdown-item",MYLEARNINGSEARCHINPUT:'[data-region="mylearning-search-input"]',ENROLTOCOURSE:".enrol_to_course"},MYLEARNINGFILTER_SHOW="filter-visible",MYLEARNINGFILTER_HIDE="filter-hidden",SEARCHFILTER_SHOW="search-visible",SEARCHFILTER_HIDE="search-hidden",filterLearningItems=function(region,selector,visibility){let elements=region.find(selector);0===elements.length?$(".nothingtodisplay").show():($(".nothingtodisplay").hide(),elements.each((function(){$(this).removeClass(MYLEARNINGFILTER_SHOW).removeClass(MYLEARNINGFILTER_HIDE),$(this).addClass(visibility)})))},updateUserPreferences=function(type,value){var request={methodname:"core_user_update_user_preferences",args:{preferences:[{type:type,value:value}]}};ajax.call([request])[0].fail(Notification.exception)},checkNothingToDisplay=function(regionSelector){const learningRegion=$(regionSelector+" "+SELECTOR.MYLEARNINGREGION);0===learningRegion.find(SELECTOR.ALL+":visible").length?learningRegion.find(".nothingtodisplay").show():learningRegion.find(".nothingtodisplay").hide()},showLearningItemsWithStatus=function(regionSelector,programfilter){M.util.js_pending("block_mylearning_filterstatus");const learningRegion=$(regionSelector+" "+SELECTOR.MYLEARNINGREGION);learningRegion.hide(),filterLearningItems(learningRegion,SELECTOR.ALL,MYLEARNINGFILTER_HIDE),filterLearningItems(learningRegion,SELECTOR[programfilter.toUpperCase()],MYLEARNINGFILTER_SHOW),updateUserPreferences("block_mylearning_status_filter",programfilter),learningRegion.fadeIn("fast",(function(){M.util.js_complete("block_mylearning_filterstatus")}))},updateMylearningDisplay=function(regionSelector,displaytype){$(regionSelector+" "+SELECTOR.MYLEARNINGREGION).removeClass("viewcards").removeClass("viewlist").addClass(displaytype),updateUserPreferences("block_mylearning_view_filter",displaytype)},updateMylearningSorting=function(regionSelector,sortorder){const learningRegion=$(regionSelector+" "+SELECTOR.MYLEARNINGREGION);let programs=learningRegion.find(SELECTOR.ALL);"mylearningname"===sortorder?programs.sort(((a,b)=>{let mylearningNameA=$(a).find(SELECTOR.LEARNINGITEMNAME).text(),mylearningNameB=$(b).find(SELECTOR.LEARNINGITEMNAME).text();return mylearningNameA.localeCompare(mylearningNameB)})):"duedate"===sortorder?programs.sort(((a,b)=>$(a).data("lowestduedate")-$(b).data("lowestduedate"))):"lastaccess"===sortorder&&programs.sort(((a,b)=>{if($(b).data("lastaccess")===$(a).data("lastaccess")){const compareA=$(a).find(SELECTOR.LEARNINGITEMNAME).text().toLowerCase(),compareB=$(b).find(SELECTOR.LEARNINGITEMNAME).text().toLowerCase();return compareA.localeCompare(compareB)}return $(b).data("lastaccess")-$(a).data("lastaccess")})),learningRegion.remove(SELECTOR.ALL).prepend(programs),updateUserPreferences("block_mylearning_sort_filter",sortorder),learningRegion.hide().fadeIn("fast")};return{init:function(regionSelector){const learningRegion=$(regionSelector);if($("#maincontent").detach().prependTo("#region-main"),$("body").on("shown shown.bs.tab",(function(){window.dispatchEvent(new Event("resize"))})),1===$(SELECTOR.MYLEARNINGREGION).data("showfilters")){let statusValue=$(regionSelector+" "+SELECTOR.MYLEARNINGSTATUSDROPDOWN).data("selected"),displayValue=$(regionSelector+" "+SELECTOR.MYLEARNINGDISPLAYDROPDOWN).data("selected"),sortingValue=$(regionSelector+" "+SELECTOR.MYLEARNINGSORTINGSDROPDOWN).data("selected");showLearningItemsWithStatus(regionSelector,statusValue),checkNothingToDisplay(regionSelector),updateMylearningDisplay(regionSelector,displayValue),updateMylearningSorting(regionSelector,sortingValue)}$(".section_expand").click((function(e){e.preventDefault(),$(this).next(".content").toggle(),$(this).find('[class$="-icon-container"]').toggle()})),learningRegion.on("click",SELECTOR.ENROLTOCOURSE,(function(e){var courseid,programid;e.preventDefault(),courseid=$(this).data("courseid"),programid=$(this).data("programid"),ajax.call([{methodname:"tool_program_enrol_user_to_course",args:{courseid:courseid,programid:programid}}])[0].done((function(response){response.status&&response.redirecturl&&(window.location.href=response.redirecturl)})).fail(Notification.exception)})).on("click",SELECTOR.MYLEARNINGSTATUSDROPDOWNITEM,(function(e){e.preventDefault(),showLearningItemsWithStatus(regionSelector,$(this).data("value")),checkNothingToDisplay(regionSelector)})).on("click",SELECTOR.MYLEARNINGDISPLAYDROPDOWNITEM,(function(e){e.preventDefault(),updateMylearningDisplay(regionSelector,$(this).data("value"))})).on("click",SELECTOR.MYLEARNINGSORTINGSDROPDOWNITEM,(function(e){e.preventDefault(),updateMylearningSorting(regionSelector,$(this).data("value"))})).on("keyup",SELECTOR.MYLEARNINGSEARCHINPUT,(function(){var query=$(this).val().toLowerCase().trim();!function(regionSelector,query){$(regionSelector+" "+SELECTOR.MYLEARNINGREGION).find(SELECTOR.ALL).filter((function(){let learningItem=$(this),dashboardText=learningItem.find(SELECTOR.LEARNINGITEMNAME).text();return dashboardText+=" "+learningItem.find(SELECTOR.COURSENAME).text(),dashboardText+=" "+learningItem.find(SELECTOR.CERTIFICATIONNAME).text(),dashboardText.toLowerCase().indexOf(query)>-1?learningItem.removeClass(SEARCHFILTER_HIDE).addClass(SEARCHFILTER_SHOW):learningItem.removeClass(SEARCHFILTER_SHOW).addClass(SEARCHFILTER_HIDE),!0}))}(regionSelector,query),checkNothingToDisplay(regionSelector)}))}}}));

//# sourceMappingURL=view.min.js.map